# ç¤ºä¾‹æ’ä»¶ (Example Plugin)

è¿™æ˜¯ä¸€ä¸ª NoteBot ç¤ºä¾‹æ’ä»¶ï¼Œå±•ç¤ºäº†æ’ä»¶ç³»ç»Ÿçš„åŸºæœ¬åŠŸèƒ½å’Œæœ€ä½³å®è·µã€‚é€šè¿‡å­¦ä¹ è¿™ä¸ªæ’ä»¶ï¼Œæ‚¨å¯ä»¥äº†è§£å¦‚ä½•å¼€å‘è‡ªå·±çš„ NoteBot æ’ä»¶ã€‚

## åŠŸèƒ½ç‰¹æ€§

### ğŸ¤– æ¶ˆæ¯å¤„ç†
- **ç§èŠæ¶ˆæ¯å¤„ç†**ï¼šå“åº”ç”¨æˆ·çš„ç§èŠæ¶ˆæ¯
- **ç¾¤èŠæ¶ˆæ¯å¤„ç†**ï¼šå¤„ç†ç¾¤ç»„ä¸­çš„æ¶ˆæ¯å’Œ @ æåŠ
- **å…³é”®è¯å›å¤**ï¼šåŸºäºå…³é”®è¯çš„è‡ªåŠ¨å›å¤åŠŸèƒ½
- **å‘½ä»¤ç³»ç»Ÿ**ï¼šæ”¯æŒå¤šç§å®ç”¨å‘½ä»¤

### ğŸ“Š ç»Ÿè®¡åŠŸèƒ½
- **æ¶ˆæ¯ç»Ÿè®¡**ï¼šè®°å½•ç§èŠã€ç¾¤èŠæ¶ˆæ¯æ•°é‡
- **å‘½ä»¤ç»Ÿè®¡**ï¼šè·Ÿè¸ªå‘½ä»¤æ‰§è¡Œæ¬¡æ•°
- **è¿è¡Œæ—¶é—´**ï¼šæ˜¾ç¤ºæ’ä»¶è¿è¡Œæ—¶é•¿
- **å®šæ—¶æŠ¥å‘Š**ï¼šå®šæœŸç”Ÿæˆç»Ÿè®¡æŠ¥å‘Š

### âœ… ç­¾åˆ°ç³»ç»Ÿ
- **æ¯æ—¥ç­¾åˆ°**ï¼šç”¨æˆ·å¯ä»¥è¿›è¡Œæ¯æ—¥ç­¾åˆ°
- **ç­¾åˆ°ç»Ÿè®¡**ï¼šè®°å½•ç”¨æˆ·ç­¾åˆ°æ¬¡æ•°å’Œå†å²
- **é˜²é‡å¤ç­¾åˆ°**ï¼šåŒä¸€å¤©åªèƒ½ç­¾åˆ°ä¸€æ¬¡

### ğŸ”§ ç®¡ç†åŠŸèƒ½
- **ç”¨æˆ·ç®¡ç†**ï¼šæ”¯æŒç”¨æˆ·é»‘åå•åŠŸèƒ½
- **ç¾¤ç»„ç®¡ç†**ï¼šå¯é…ç½®å…è®¸ä½¿ç”¨çš„ç¾¤ç»„
- **æƒé™æ§åˆ¶**ï¼šåŸºäºç”¨æˆ·æƒé™çš„åŠŸèƒ½è®¿é—®
- **é…ç½®ç®¡ç†**ï¼šçµæ´»çš„é…ç½®é€‰é¡¹

### ğŸŒ Web API
- **ç»Ÿè®¡æ¥å£**ï¼šé€šè¿‡ HTTP API è·å–ç»Ÿè®¡ä¿¡æ¯
- **æ¶ˆæ¯å‘é€**ï¼šé€šè¿‡ API å‘é€æ¶ˆæ¯
- **RESTful è®¾è®¡**ï¼šæ ‡å‡†çš„ REST API æ¥å£

## å®‰è£…æ–¹æ³•

### 1. è‡ªåŠ¨å®‰è£…ï¼ˆæ¨èï¼‰

é€šè¿‡ NoteBot ç®¡ç†åå°å®‰è£…ï¼š

1. æ‰“å¼€ NoteBot Web ç®¡ç†ç•Œé¢
2. è¿›å…¥ã€Œæ’ä»¶ç®¡ç†ã€é¡µé¢
3. ç‚¹å‡»ã€Œå®‰è£…æ’ä»¶ã€
4. é€‰æ‹©ç¤ºä¾‹æ’ä»¶å¹¶å®‰è£…

### 2. æ‰‹åŠ¨å®‰è£…

1. å°†æ’ä»¶æ–‡ä»¶å¤åˆ¶åˆ° `plugins/example/` ç›®å½•
2. é‡å¯ NoteBot æˆ–é€šè¿‡ç®¡ç†ç•Œé¢é‡è½½æ’ä»¶

```bash
# å¤åˆ¶æ’ä»¶æ–‡ä»¶
cp -r example/ /path/to/notebot/plugins/

# é‡å¯ NoteBot
npm run restart
```

## é…ç½®é€‰é¡¹

æ’ä»¶æ”¯æŒä»¥ä¸‹é…ç½®é€‰é¡¹ï¼Œå¯é€šè¿‡ Web ç®¡ç†ç•Œé¢æˆ–é…ç½®æ–‡ä»¶è¿›è¡Œè®¾ç½®ï¼š

### åŸºç¡€é…ç½®

```json
{
  "welcomeMessage": "æ¬¢è¿ä½¿ç”¨ç¤ºä¾‹æ’ä»¶ï¼",
  "enableStats": true,
  "maxMessageLength": 1000,
  "allowedGroups": [],
  "bannedUsers": []
}
```

### è‡ªåŠ¨å›å¤é…ç½®

```json
{
  "autoReply": {
    "enabled": true,
    "keywords": {
      "ä½ å¥½": "ä½ å¥½ï¼æˆ‘æ˜¯ç¤ºä¾‹æ’ä»¶",
      "hello": "Hello! I'm the example plugin",
      "æ—¶é—´": "å½“å‰æ—¶é—´ï¼š{time}",
      "å¸®åŠ©": "å‘é€ /help æŸ¥çœ‹å¯ç”¨å‘½ä»¤"
    }
  }
}
```

### ç­¾åˆ°ç³»ç»Ÿé…ç½®

```json
{
  "checkIn": {
    "enabled": true,
    "rewards": {
      "points": 10,
      "bonus": {
        "consecutive": 7,
        "points": 50
      }
    }
  }
}
```

### é¢‘ç‡é™åˆ¶é…ç½®

```json
{
  "rateLimiting": {
    "enabled": true,
    "maxRequests": 10,
    "windowMs": 60000
  }
}
```

## ä½¿ç”¨æ–¹æ³•

### å‘½ä»¤åˆ—è¡¨

| å‘½ä»¤ | æè¿° | ç”¨æ³• | åˆ«å |
|------|------|------|------|
| `/help` | æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯ | `/help` | `/h`, `/å¸®åŠ©` |
| `/ping` | æµ‹è¯•å“åº”æ—¶é—´ | `/ping` | `/p` |
| `/stats` | æ˜¾ç¤ºç»Ÿè®¡ä¿¡æ¯ | `/stats` | `/ç»Ÿè®¡`, `/stat` |
| `/echo` | å›æ˜¾æ¶ˆæ¯ | `/echo <æ¶ˆæ¯>` | `/å›æ˜¾` |
| `/time` | æ˜¾ç¤ºå½“å‰æ—¶é—´ | `/time` | `/æ—¶é—´`, `/t` |

### å…³é”®è¯å›å¤

å‘é€ä»¥ä¸‹å…³é”®è¯å¯è§¦å‘è‡ªåŠ¨å›å¤ï¼š

- **ä½ å¥½** / **hello** - è·å¾—æ¬¢è¿æ¶ˆæ¯
- **æ—¶é—´** - è·å–å½“å‰æ—¶é—´
- **ç»Ÿè®¡** - æŸ¥çœ‹æ’ä»¶ç»Ÿè®¡ä¿¡æ¯
- **ç­¾åˆ°** - è¿›è¡Œæ¯æ—¥ç­¾åˆ°ï¼ˆä»…ç¾¤èŠï¼‰
- **å¸®åŠ©** - æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯

### ç¾¤èŠåŠŸèƒ½

åœ¨ç¾¤èŠä¸­ï¼Œæ‚¨å¯ä»¥ï¼š

1. **@ æœºå™¨äºº**ï¼šç›´æ¥ @ æœºå™¨äººè¿›è¡Œå¯¹è¯
2. **ç­¾åˆ°åŠŸèƒ½**ï¼šå‘é€ã€Œç­¾åˆ°ã€è¿›è¡Œæ¯æ—¥ç­¾åˆ°
3. **å‘½ä»¤ä½¿ç”¨**ï¼šä½¿ç”¨æ‰€æœ‰æ”¯æŒçš„å‘½ä»¤
4. **å…³é”®è¯å›å¤**ï¼šè§¦å‘è‡ªåŠ¨å›å¤åŠŸèƒ½

### ç§èŠåŠŸèƒ½

åœ¨ç§èŠä¸­ï¼Œæ‚¨å¯ä»¥ï¼š

1. **ç›´æ¥å¯¹è¯**ï¼šå‘é€æ¶ˆæ¯ä¸æœºå™¨äººå¯¹è¯
2. **å‘½ä»¤ä½¿ç”¨**ï¼šä½¿ç”¨æ‰€æœ‰æ”¯æŒçš„å‘½ä»¤
3. **è·å–ç»Ÿè®¡**ï¼šæŸ¥çœ‹è¯¦ç»†çš„ä½¿ç”¨ç»Ÿè®¡
4. **é…ç½®æŸ¥è¯¢**ï¼šæŸ¥çœ‹å½“å‰é…ç½®ä¿¡æ¯

## API æ¥å£

### è·å–ç»Ÿè®¡ä¿¡æ¯

```http
GET /api/plugins/example/stats
```

**å“åº”ç¤ºä¾‹ï¼š**

```json
{
  "success": true,
  "data": {
    "totalMessages": 1234,
    "privateMessages": 567,
    "groupMessages": 667,
    "commandsExecuted": 89,
    "uptime": "2å°æ—¶34åˆ†é’Ÿ12ç§’",
    "currentMessages": 45
  }
}
```

### å‘é€æ¶ˆæ¯

```http
POST /api/plugins/example/send
Content-Type: application/json
Authorization: Bearer <token>

{
  "type": "private",
  "target": "123456789",
  "message": "Hello from API!"
}
```

**å‚æ•°è¯´æ˜ï¼š**

- `type`: æ¶ˆæ¯ç±»å‹ï¼Œ`private` æˆ– `group`
- `target`: ç›®æ ‡ç”¨æˆ·IDæˆ–ç¾¤ç»„ID
- `message`: è¦å‘é€çš„æ¶ˆæ¯å†…å®¹

## å¼€å‘æŒ‡å—

### æ’ä»¶ç»“æ„

```
example/
â”œâ”€â”€ index.js          # ä¸»æ’ä»¶æ–‡ä»¶
â”œâ”€â”€ plugin.json       # æ’ä»¶é…ç½®æ–‡ä»¶
â”œâ”€â”€ README.md         # è¯´æ˜æ–‡æ¡£
â””â”€â”€ package.json      # ä¾èµ–é…ç½®ï¼ˆå¯é€‰ï¼‰
```

### æ ¸å¿ƒæ¦‚å¿µ

#### 1. æ’ä»¶åŸºç±»

æ‰€æœ‰æ’ä»¶éƒ½åº”ç»§æ‰¿è‡ª `BasePlugin` ç±»ï¼š

```javascript
const BasePlugin = require('../../src/plugins/base');

class ExamplePlugin extends BasePlugin {
    constructor() {
        super({
            name: 'example',
            version: '1.0.0',
            description: 'ç¤ºä¾‹æ’ä»¶',
            // ... å…¶ä»–é…ç½®
        });
    }
}
```

#### 2. ç”Ÿå‘½å‘¨æœŸæ–¹æ³•

```javascript
// æ’ä»¶åˆå§‹åŒ–
async initialize() {
    await super.initialize();
    // è‡ªå®šä¹‰åˆå§‹åŒ–é€»è¾‘
}

// æ’ä»¶é”€æ¯
async destroy() {
    // æ¸…ç†èµ„æº
    await super.destroy();
}
```

#### 3. æ¶ˆæ¯å¤„ç†

```javascript
// æ³¨å†Œæ¶ˆæ¯å¤„ç†å™¨
this.registerMessageHandler('private', this.handlePrivateMessage.bind(this));
this.registerMessageHandler('group', this.handleGroupMessage.bind(this));

// å¤„ç†æ¶ˆæ¯
async handlePrivateMessage(message) {
    const { user_id, raw_message } = message;
    // å¤„ç†é€»è¾‘
}
```

#### 4. äº‹ä»¶å¤„ç†

```javascript
// æ³¨å†Œäº‹ä»¶å¤„ç†å™¨
this.registerEventHandler('friend_add', this.handleFriendAdd.bind(this));

// å¤„ç†äº‹ä»¶
async handleFriendAdd(event) {
    const { user_id } = event;
    // å¤„ç†é€»è¾‘
}
```

#### 5. å®šæ—¶ä»»åŠ¡

```javascript
// æ³¨å†Œå®šæ—¶ä»»åŠ¡
this.registerScheduledTask('stats-report', '0 */10 * * * *', this.reportStats.bind(this));

// ä»»åŠ¡å¤„ç†
async reportStats() {
    // å®šæ—¶ä»»åŠ¡é€»è¾‘
}
```

#### 6. HTTP è·¯ç”±

```javascript
// æ³¨å†Œè·¯ç”±
this.registerRoute('GET', '/stats', this.getStats.bind(this));
this.registerRoute('POST', '/send', this.sendMessage.bind(this));

// è·¯ç”±å¤„ç†
async getStats(req, res) {
    res.json({ success: true, data: stats });
}
```

#### 7. æ•°æ®å­˜å‚¨

```javascript
// å­˜å‚¨æ•°æ®
await this.setData('key', value);

// è¯»å–æ•°æ®
const value = await this.getData('key');

// åˆ é™¤æ•°æ®
await this.deleteData('key');
```

### æœ€ä½³å®è·µ

#### 1. é”™è¯¯å¤„ç†

```javascript
try {
    // ä¸šåŠ¡é€»è¾‘
} catch (error) {
    logger.error('Error in plugin:', error);
    // é”™è¯¯å¤„ç†
}
```

#### 2. æ—¥å¿—è®°å½•

```javascript
const logger = require('../../src/utils/logger');

logger.info('Plugin initialized');
logger.warn('Warning message');
logger.error('Error occurred:', error);
logger.debug('Debug information');
```

#### 3. é…ç½®ç®¡ç†

```javascript
// è·å–é…ç½®
const config = await this.getData('config');

// ä½¿ç”¨é»˜è®¤é…ç½®
const defaultConfig = { /* é»˜è®¤å€¼ */ };
const config = await this.getData('config') || defaultConfig;
```

#### 4. æƒé™æ£€æŸ¥

```javascript
// æ£€æŸ¥ç”¨æˆ·æƒé™
if (!this.hasPermission(user_id, 'admin')) {
    return;
}

// æ£€æŸ¥ç¾¤ç»„æƒé™
if (!this.isGroupAllowed(group_id)) {
    return;
}
```

## æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

#### 1. æ’ä»¶æ— æ³•åŠ è½½

**é—®é¢˜**ï¼šæ’ä»¶åœ¨ç®¡ç†ç•Œé¢æ˜¾ç¤ºä¸ºã€ŒåŠ è½½å¤±è´¥ã€

**è§£å†³æ–¹æ¡ˆ**ï¼š
- æ£€æŸ¥ `plugin.json` æ–‡ä»¶æ ¼å¼æ˜¯å¦æ­£ç¡®
- ç¡®è®¤ `index.js` æ–‡ä»¶è¯­æ³•æ— è¯¯
- æŸ¥çœ‹æ—¥å¿—æ–‡ä»¶ä¸­çš„é”™è¯¯ä¿¡æ¯

#### 2. æ¶ˆæ¯æ— å“åº”

**é—®é¢˜**ï¼šå‘é€æ¶ˆæ¯åæ’ä»¶æ— å“åº”

**è§£å†³æ–¹æ¡ˆ**ï¼š
- ç¡®è®¤æ’ä»¶å·²å¯ç”¨
- æ£€æŸ¥ç”¨æˆ·æ˜¯å¦åœ¨é»‘åå•ä¸­
- éªŒè¯ç¾¤ç»„æ˜¯å¦åœ¨å…è®¸åˆ—è¡¨ä¸­
- æŸ¥çœ‹æ’ä»¶æ—¥å¿—

#### 3. å‘½ä»¤ä¸å·¥ä½œ

**é—®é¢˜**ï¼šå‘é€å‘½ä»¤åæ— ååº”

**è§£å†³æ–¹æ¡ˆ**ï¼š
- ç¡®è®¤å‘½ä»¤æ ¼å¼æ­£ç¡®ï¼ˆä»¥ `/` å¼€å¤´ï¼‰
- æ£€æŸ¥å‘½ä»¤æ˜¯å¦å·²æ³¨å†Œ
- éªŒè¯ç”¨æˆ·æƒé™

#### 4. å®šæ—¶ä»»åŠ¡ä¸æ‰§è¡Œ

**é—®é¢˜**ï¼šå®šæ—¶ä»»åŠ¡æ²¡æœ‰æŒ‰é¢„æœŸæ‰§è¡Œ

**è§£å†³æ–¹æ¡ˆ**ï¼š
- æ£€æŸ¥ cron è¡¨è¾¾å¼æ ¼å¼
- ç¡®è®¤æ’ä»¶å·²å¯ç”¨
- æŸ¥çœ‹è°ƒåº¦å™¨æ—¥å¿—

### è°ƒè¯•æŠ€å·§

#### 1. å¯ç”¨è°ƒè¯•æ—¥å¿—

åœ¨é…ç½®æ–‡ä»¶ä¸­è®¾ç½®æ—¥å¿—çº§åˆ«ä¸º `debug`ï¼š

```json
{
  "logger": {
    "level": "debug"
  }
}
```

#### 2. ä½¿ç”¨æ§åˆ¶å°è¾“å‡º

åœ¨å¼€å‘è¿‡ç¨‹ä¸­å¯ä»¥ä½¿ç”¨ `console.log` è¿›è¡Œè°ƒè¯•ï¼š

```javascript
console.log('Debug info:', data);
```

#### 3. æŸ¥çœ‹æ’ä»¶çŠ¶æ€

é€šè¿‡ç®¡ç†ç•Œé¢æŸ¥çœ‹æ’ä»¶çš„è¿è¡ŒçŠ¶æ€å’Œç»Ÿè®¡ä¿¡æ¯ã€‚

## æ‰©å±•å¼€å‘

### æ·»åŠ æ–°åŠŸèƒ½

1. **æ–°å¢å‘½ä»¤**ï¼šåœ¨ `handleCommand` æ–¹æ³•ä¸­æ·»åŠ æ–°çš„å‘½ä»¤å¤„ç†é€»è¾‘
2. **æ–°å¢äº‹ä»¶**ï¼šæ³¨å†Œæ–°çš„äº‹ä»¶å¤„ç†å™¨
3. **æ–°å¢API**ï¼šæ·»åŠ æ–°çš„ HTTP è·¯ç”±
4. **æ–°å¢å®šæ—¶ä»»åŠ¡**ï¼šæ³¨å†Œæ–°çš„å®šæ—¶ä»»åŠ¡

### è‡ªå®šä¹‰é…ç½®

åœ¨ `plugin.json` ä¸­æ·»åŠ æ–°çš„é…ç½®é€‰é¡¹ï¼š

```json
{
  "notebot": {
    "config": {
      "schema": {
        "properties": {
          "newOption": {
            "type": "string",
            "default": "default value",
            "description": "æ–°é…ç½®é€‰é¡¹"
          }
        }
      }
    }
  }
}
```

### æ•°æ®åº“é›†æˆ

å¦‚æœéœ€è¦æ›´å¤æ‚çš„æ•°æ®å­˜å‚¨ï¼Œå¯ä»¥é›†æˆæ•°æ®åº“ï¼š

```javascript
// ä½¿ç”¨ Redis
const redis = require('../../src/database/redis');
const value = await redis.get('key');

// ä½¿ç”¨å…¶ä»–æ•°æ®åº“
const db = require('./database');
const result = await db.query('SELECT * FROM table');
```

## è®¸å¯è¯

MIT License - è¯¦è§ [LICENSE](LICENSE) æ–‡ä»¶

## è´¡çŒ®

æ¬¢è¿æäº¤ Issue å’Œ Pull Requestï¼

## æ”¯æŒ

å¦‚æœæ‚¨åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­é‡åˆ°é—®é¢˜ï¼Œå¯ä»¥ï¼š

1. æŸ¥çœ‹æœ¬æ–‡æ¡£çš„æ•…éšœæ’é™¤éƒ¨åˆ†
2. åœ¨ GitHub ä¸Šæäº¤ Issue
3. åŠ å…¥å®˜æ–¹äº¤æµç¾¤è·å–å¸®åŠ©

---

**æ³¨æ„**ï¼šè¿™æ˜¯ä¸€ä¸ªç¤ºä¾‹æ’ä»¶ï¼Œä¸»è¦ç”¨äºå­¦ä¹ å’Œå‚è€ƒã€‚åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨å‰ï¼Œè¯·æ ¹æ®å®é™…éœ€æ±‚è¿›è¡Œé€‚å½“çš„ä¿®æ”¹å’Œæµ‹è¯•ã€‚